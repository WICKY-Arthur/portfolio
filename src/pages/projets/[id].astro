---
import Layout from "../../layouts/Layout.astro";
import Menu from "../../components/menu.astro";
import Footer from "../../components/footer.astro";

// Fonction requise pour les routes dynamiques
export async function getStaticPaths() {
    const POCKETBASE_URL = "https://portfolio.arthurwicky.fr:443";

    try {
        const response = await fetch(
            `${POCKETBASE_URL}/api/collections/Projets/records?perPage=100`,
        );

        if (!response.ok) {
            console.error("Erreur HTTP:", response.status);
            return [];
        }

        const data = await response.json();
        console.log("Projets récupérés:", data.items.length);

        return data.items.map((projet: any) => ({
            params: { id: projet.id },
            props: { projet },
        }));
    } catch (error) {
        console.error("Erreur lors de la récupération des projets:", error);
        return [];
    }
}

const { projet } = Astro.props;
const POCKETBASE_URL = "https://portfolio.arthurwicky.fr:443";

// Fonction pour obtenir l'URL d'un fichier
function getCoverUrl(filename: string) {
    return `${POCKETBASE_URL}/api/files/${projet.collectionId}/${projet.id}/${filename}`;
}

// Fonction pour obtenir toutes les images desktop
function getImageUrls() {
    if (!projet.images || projet.images.length === 0) return [];
    return projet.images.map((img: string) => getCoverUrl(img));
}

// Fonction pour obtenir toutes les images mobiles
function getMobileImageUrls() {
    if (!projet.images_mobile || projet.images_mobile.length === 0) return [];
    return projet.images_mobile.map((img: string) => getCoverUrl(img));
}

const images = getImageUrls();
const mobileImages = getMobileImageUrls();
---

<Layout title={`${projet.title} - Arthur Wicky`}>
    <Menu />

    <main class="min-h-screen">
        <!-- Version Desktop -->
        <div class="hidden md:block mx-16 py-32">
            <div class="grid grid-cols-12 gap-16">
                <!-- Colonne gauche - Texte sticky -->
                <div class="col-span-5">
                    <div class="sticky top-32 space-y-8">
                        <h1
                            class="text-7xl font-bold text-gray-900 uppercase"
                            style="font-family: 'Satoshi Variable', sans-serif;"
                        >
                            {projet.title}
                        </h1>

                        <div class="flex items-center gap-4 text-lg">
                            <span
                                class="font-normal"
                                style="font-family: 'Satoshi', sans-serif;"
                            >
                                {projet.type}
                            </span>
                            <span class="w-2 h-2 rounded-full bg-gray-900"
                            ></span>
                            <span
                                class=""
                                style="font-family: 'Satoshi', sans-serif;"
                            >
                                {projet.date}
                            </span>
                        </div>

                        <div class="space-y-4">
                            <h2
                                class="text-3xl font-bold text-gray-900"
                                style="font-family: 'Satoshi Variable', sans-serif;"
                            >
                                LE PROJET
                            </h2>
                            <p
                                class="text-sm leading-relaxed text-gray-800"
                                style="font-family: 'Satoshi', sans-serif;"
                            >
                                {projet.description}
                            </p>
                        </div>

                        <div class="space-y-4">
                            <h2
                                class="text-3xl font-bold text-gray-900"
                                style="font-family: 'Satoshi Variable', sans-serif;"
                            >
                                L'EXPÉRIENCE
                            </h2>
                            <p
                                class="text-sm leading-relaxed text-gray-800"
                                style="font-family: 'Satoshi', sans-serif;"
                            >
                                {projet.experience}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Colonne droite - Images -->
                <div class="col-span-7">
                    <div class="space-y-8">
                        {
                            images.map((imageUrl: string) => (
                                <img
                                    src={imageUrl}
                                    alt={projet.title}
                                    class="w-full h-auto object-cover rounded-lg"
                                />
                            ))
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Version Mobile -->
        <div class="md:hidden px-6 py-12 mt-24">
            <div class="space-y-6">
                <!-- Titre -->
                <h1
                    class="text-5xl font-bold text-gray-900 uppercase leading-10"
                    style="font-family: 'Satoshi Variable', sans-serif;"
                >
                    {projet.title}
                </h1>

                <!-- Type et Date -->
                <div class="flex items-center gap-2 text-base">
                    <span
                        class="font-normal"
                        style="font-family: 'Satoshi', sans-serif;"
                    >
                        {projet.type}
                    </span>
                    <span class="w-2 h-2 rounded-full bg-gray-900"></span>
                    <span style="font-family: 'Satoshi', sans-serif;">
                        {projet.date}
                    </span>
                </div>

                <!-- Première image mobile -->
                {
                    mobileImages.length > 0 && (
                        <img
                            src={mobileImages[0]}
                            alt={projet.title}
                            class="w-full h-auto object-cover rounded-lg"
                        />
                    )
                }

                <!-- Le Projet -->
                <div class="space-y-4">
                    <h2
                        class="text-3xl font-bold text-gray-900"
                        style="font-family: 'Satoshi Variable', sans-serif;"
                    >
                        LE PROJET
                    </h2>
                    <p
                        class="text-sm leading-relaxed text-gray-800"
                        style="font-family: 'Satoshi', sans-serif;"
                    >
                        {projet.description}
                    </p>
                </div>

                <!-- L'Expérience -->
                <div class="space-y-4">
                    <h2
                        class="text-3xl font-bold text-gray-900"
                        style="font-family: 'Satoshi Variable', sans-serif;"
                    >
                        L'EXPÉRIENCE
                    </h2>
                    <p
                        class="text-sm leading-relaxed text-gray-800"
                        style="font-family: 'Satoshi', sans-serif;"
                    >
                        {projet.experience}
                    </p>
                </div>

                <!-- Reste des images mobiles -->
                {
                    mobileImages
                        .slice(1)
                        .map((imageUrl: string) => (
                            <img
                                src={imageUrl}
                                alt={projet.title}
                                class="w-full h-auto object-cover rounded-lg"
                            />
                        ))
                }
            </div>
        </div>
    </main>

    <Footer />
</Layout>
